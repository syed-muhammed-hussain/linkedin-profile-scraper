<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Profile Scraper</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/index.js"></script>
    
    <style>
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        // Add the FULL app.js content here directly
        const { useState, useEffect } = React;
        const { Search, User, LogOut, Loader2, CheckCircle, AlertCircle } = LucideReact;

        // Storage utility
        const storage = {
            get: (key) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? { value: item } : null;
                } catch (error) {
                    console.error('Storage get error:', error);
                    return null;
                }
            },
            set: (key, value) => {
                try {
                    localStorage.setItem(key, value);
                    return { success: true };
                } catch (error) {
                    console.error('Storage set error:', error);
                    return { success: false };
                }
            },
            delete: (key) => {
                try {
                    localStorage.removeItem(key);
                    return { success: true };
                } catch (error) {
                    console.error('Storage delete error:', error);
                    return { success: false };
                }
            },
            list: (prefix) => {
                try {
                    const keys = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith(prefix)) {
                            keys.push(key);
                        }
                    }
                    return { keys };
                } catch (error) {
                    console.error('Storage list error:', error);
                    return { keys: [] };
                }
            }
        };

        const App = () => {
            const [currentPage, setCurrentPage] = React.useState('login');
            const [currentUser, setCurrentUser] = React.useState(null);
            const [users, setUsers] = React.useState([]);
            const [searchResults, setSearchResults] = React.useState(null);
            const [isSearching, setIsSearching] = React.useState(false);
            
            // Form states
            const [loginEmail, setLoginEmail] = React.useState('');
            const [loginPassword, setLoginPassword] = React.useState('');
            const [signupData, setSignupData] = React.useState({
                name: '',
                email: '',
                password: '',
                confirmPassword: ''
            });
            const [searchParams, setSearchParams] = React.useState({
                keyword: '',
                city: '',
                maxResults: 10,
                resultsPerPage: 10,
                totalPages: 1,
                apiKey: '',
                searchEngineId: ''
            });
            const [adminCredentials, setAdminCredentials] = React.useState({
                username: '',
                password: ''
            });
            const [isAdminAuthenticated, setIsAdminAuthenticated] = React.useState(false);

            // Load data from storage
            React.useEffect(() => {
                loadUsers();
                loadCurrentUser();
            }, []);

            const loadUsers = async () => {
                try {
                    const result = await storage.list('user:');
                    if (result && result.keys) {
                        const userPromises = result.keys.map(key => storage.get(key));
                        const userResults = await Promise.all(userPromises);
                        const loadedUsers = userResults
                            .filter(r => r && r.value)
                            .map(r => JSON.parse(r.value));
                        setUsers(loadedUsers);
                    }
                } catch (error) {
                    console.log('No users found yet');
                }
            };

            const loadCurrentUser = async () => {
                try {
                    const result = await storage.get('current_user');
                    if (result && result.value) {
                        const user = JSON.parse(result.value);
                        setCurrentUser(user);
                        setCurrentPage('home');
                    }
                } catch (error) {
                    console.log('No current user');
                }
            };

            const handleSignup = async () => {
                if (signupData.password !== signupData.confirmPassword) {
                    alert('Passwords do not match!');
                    return;
                }

                if (signupData.password.length < 6) {
                    alert('Password must be at least 6 characters!');
                    return;
                }

                const newUser = {
                    id: Date.now().toString(),
                    name: signupData.name,
                    email: signupData.email.toLowerCase(),
                    password: signupData.password,
                    isApproved: false,
                    createdAt: new Date().toISOString()
                };

                try {
                    await storage.set(`user:${newUser.id}`, JSON.stringify(newUser));
                    alert('Account created! Please wait for admin approval.');
                    setSignupData({ name: '', email: '', password: '', confirmPassword: '' });
                    setCurrentPage('login');
                    loadUsers();
                } catch (error) {
                    alert('Error creating account. Please try again.');
                }
            };

            const handleLogin = async () => {
                try {
                    const result = await storage.list('user:');
                    if (!result || !result.keys) {
                        alert('No users found. Please sign up first.');
                        return;
                    }

                    const userPromises = result.keys.map(key => storage.get(key));
                    const userResults = await Promise.all(userPromises);
                    const allUsers = userResults
                        .filter(r => r && r.value)
                        .map(r => JSON.parse(r.value));

                    const user = allUsers.find(
                        u => u.email === loginEmail.toLowerCase() && u.password === loginPassword
                    );

                    if (!user) {
                        alert('Invalid email or password!');
                        return;
                    }

                    if (!user.isApproved) {
                        alert('Your account is pending admin approval. Please wait.');
                        return;
                    }

                    await storage.set('current_user', JSON.stringify(user));
                    setCurrentUser(user);
                    setCurrentPage('home');
                    setLoginEmail('');
                    setLoginPassword('');
                } catch (error) {
                    alert('Error logging in. Please try again.');
                }
            };

            const handleLogout = async () => {
                try {
                    await storage.delete('current_user');
                    setCurrentUser(null);
                    setCurrentPage('login');
                    setSearchResults(null);
                } catch (error) {
                    console.error('Logout error:', error);
                }
            };

            const toggleUserApproval = async (userId) => {
                try {
                    const result = await storage.get(`user:${userId}`);
                    if (result && result.value) {
                        const user = JSON.parse(result.value);
                        user.isApproved = !user.isApproved;
                        await storage.set(`user:${userId}`, JSON.stringify(user));
                        loadUsers();
                    }
                } catch (error) {
                    alert('Error updating user status');
                }
            };

            const handleAdminLogin = () => {
                const ADMIN_USERNAME = 'admin';
                const ADMIN_PASSWORD = 'Admin@2024';
                
                if (adminCredentials.username === ADMIN_USERNAME && adminCredentials.password === ADMIN_PASSWORD) {
                    setIsAdminAuthenticated(true);
                    setAdminCredentials({ username: '', password: '' });
                } else {
                    alert('Invalid admin credentials!');
                }
            };

            const handleSearch = async () => {
                if (!searchParams.keyword || !searchParams.city) {
                    alert('Please enter both keyword and city');
                    return;
                }

                if (!searchParams.apiKey || !searchParams.searchEngineId) {
                    alert('Please enter API Key and Search Engine ID');
                    return;
                }

                setIsSearching(true);
                setSearchResults(null);

                try {
                    const response = await fetch('https://n8n.boundlesshhr.com/webhook/linkedin-scraper', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            keyword: searchParams.keyword,
                            city: searchParams.city,
                            maxResults: parseInt(searchParams.maxResults),
                            apiKey: searchParams.apiKey,
                            searchEngineId: searchParams.searchEngineId,
                            resultsPerPage: parseInt(searchParams.resultsPerPage),
                            totalPages: parseInt(searchParams.totalPages)
                        })
                    });

                    const data = await response.json();
                    setSearchResults(data);
                    setCurrentPage('results');
                } catch (error) {
                    alert('Error searching. Please check your API credentials and try again.');
                    console.error('Search error:', error);
                } finally {
                    setIsSearching(false);
                }
            };

            // Simple Login Component
            const LoginPage = () => {
                return React.createElement('div', { 
                    className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4" 
                },
                    React.createElement('div', { 
                        className: "bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md" 
                    },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { 
                                className: "w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4" 
                            },
                                React.createElement(Search, { className: "w-8 h-8 text-white" })
                            ),
                            React.createElement('h1', { className: "text-3xl font-bold text-gray-800" }, "LinkedIn Scraper"),
                            React.createElement('p', { className: "text-gray-600 mt-2" }, "Sign in to your account")
                        ),
                        
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Email"),
                                React.createElement('input', {
                                    type: "email",
                                    value: loginEmail,
                                    onChange: (e) => setLoginEmail(e.target.value),
                                    className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",
                                    placeholder: "your@email.com"
                                })
                            ),
                            
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Password"),
                                React.createElement('input', {
                                    type: "password",
                                    value: loginPassword,
                                    onChange: (e) => setLoginPassword(e.target.value),
                                    className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",
                                    placeholder: "••••••••"
                                })
                            ),
                            
                            React.createElement('button', {
                                onClick: handleLogin,
                                className: "w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition font-medium"
                            }, "Sign In")
                        ),
                        
                        React.createElement('div', { className: "mt-6 text-center" },
                            React.createElement('p', { className: "text-gray-600" },
                                "Don't have an account? ",
                                React.createElement('button', {
                                    onClick: () => setCurrentPage('signup'),
                                    className: "text-indigo-600 hover:text-indigo-700 font-medium"
                                }, "Sign up")
                            )
                        ),

                        React.createElement('div', { className: "mt-4 text-center" },
                            React.createElement('button', {
                                onClick: () => setCurrentPage('admin'),
                                className: "text-sm text-gray-500 hover:text-gray-700"
                            }, "Admin Panel")
                        )
                    )
                );
            };

            // Simple Signup Component
            const SignupPage = () => {
                return React.createElement('div', { 
                    className: "min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4" 
                },
                    React.createElement('div', { 
                        className: "bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md" 
                    },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { 
                                className: "w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4" 
                            },
                                React.createElement(User, { className: "w-8 h-8 text-white" })
                            ),
                            React.createElement('h1', { className: "text-3xl font-bold text-gray-800" }, "Create Account"),
                            React.createElement('p', { className: "text-gray-600 mt-2" }, "Join LinkedIn Scraper")
                        ),
                        
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Full Name"),
                                React.createElement('input', {
                                    type: "text",
                                    value: signupData.name,
                                    onChange: (e) => setSignupData({...signupData, name: e.target.value}),
                                    className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",
                                    placeholder: "John Doe"
                                })
                            ),
                            
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Email"),
                                React.createElement('input', {
                                    type: "email",
                                    value: signupData.email,
                                    onChange: (e) => setSignupData({...signupData, email: e.target.value}),
                                    className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",
                                    placeholder: "your@email.com"
                                })
                            ),
                            
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Password"),
                                React.createElement('input', {
                                    type: "password",
                                    value: signupData.password,
                                    onChange: (e) => setSignupData({...signupData, password: e.target.value}),
                                    className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",
                                    placeholder: "••••••••"
                                })
                            ),
                            
                            React.createElement('div', null,
                                React.createElement('label', { className: "block text-sm font-medium text-gray-700 mb-2" }, "Confirm Password"),
                                React.createElement('input', {
                                    type: "password",
                                    value: signupData.confirmPassword,
                                    onChange: (e) => setSignupData({...signupData, confirmPassword: e.target.value}),
                                    className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",
                                    placeholder: "••••••••"
                                })
                            ),
                            
                            React.createElement('button', {
                                onClick: handleSignup,
                                className: "w-full bg-indigo-600 text-white py-3 rounded-lg hover:bg-indigo-700 transition font-medium"
                            }, "Create Account")
                        ),
                        
                        React.createElement('div', { className: "mt-6 text-center" },
                            React.createElement('p', { className: "text-gray-600" },
                                "Already have an account? ",
                                React.createElement('button', {
                                    onClick: () => setCurrentPage('login'),
                                    className: "text-indigo-600 hover:text-indigo-700 font-medium"
                                }, "Sign in")
                            )
                        )
                    )
                );
            };

            // Render based on current page
            if (currentPage === 'signup') {
                return React.createElement(SignupPage);
            }
            if (currentPage === 'login') {
                return React.createElement(LoginPage);
            }

            return React.createElement(LoginPage);
        };

        // Render the app
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
